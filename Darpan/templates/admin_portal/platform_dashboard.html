{% extends "base/base.html" %}

{% block title %}Platform Admin Dashboard{% endblock %}

{% block navbar %}
{% include "base/navbar.html" %}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>Platform Administration</h2>
            <p class="text-muted mb-0">Manage companies and their administrators</p>
        </div>
        <a href="{% url 'admin_portal:company_create' %}" class="btn btn-primary">
            <i data-lucide="plus" class="me-1"></i> Add Company
        </a>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm border-start border-4 border-primary h-100">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase small">Total Companies</h6>
                    <h3 class="mb-0">{{ total_companies }}</h3>
                    <small class="text-success">{{ active_companies }} Active</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm border-start border-4 border-info h-100">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase small">Quick Actions</h6>
                    <a href="{% url 'admin_portal:company_list' %}" class="btn btn-outline-primary btn-sm">
                        <i data-lucide="building" class="me-1" style="width: 14px;"></i> View All Companies
                    </a>
                    <a href="{% url 'admin_portal:data_backup' %}" class="btn btn-outline-success btn-sm mt-2">
                        <i data-lucide="database" class="me-1" style="width: 14px;"></i> Data Backup
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm border-start border-4 border-success h-100">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase small">Platform Role</h6>
                    <span class="badge bg-success fs-6">Platform Admin</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Companies Overview -->
    <div class="card shadow-sm">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Companies Overview</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4">Company</th>
                        <th>Code</th>
                        <th>Users</th>
                        <th>Stores</th>
                        <th>Status</th>
                        <th class="text-end pe-4">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for company in companies %}
                    <tr>
                        <td class="ps-4 fw-bold">{{ company.name }}</td>
                        <td><code>{{ company.company_code }}</code></td>
                        <td>{{ company.user_count }}</td>
                        <td>{{ company.store_count }}</td>
                        <td>
                            {% if company.is_active %}
                            <span class="badge bg-success">Active</span>
                            {% else %}
                            <span class="badge bg-danger">Inactive</span>
                            {% endif %}
                        </td>
                        <td class="text-end pe-4">
                            <a href="{% url 'admin_portal:company_admin_create' company.pk %}"
                                class="btn btn-sm btn-outline-success me-1" title="Create Admin">
                                <i data-lucide="user-plus" style="width: 16px;"></i>
                            </a>
                            <a href="{% url 'admin_portal:company_modules' company.pk %}"
                                class="btn btn-sm btn-outline-info me-1" title="Manage Modules">
                                <i data-lucide="grid" style="width: 16px;"></i>
                            </a>
                            <a href="{% url 'admin_portal:company_update' company.pk %}"
                                class="btn btn-sm btn-outline-primary" title="Edit Company">
                                <i data-lucide="edit-2" style="width: 16px;"></i>
                            </a>
                            <a href="{% url 'admin_portal:company_delete' company.pk %}"
                                class="btn btn-sm btn-outline-danger" title="Delete Company">
                                <i data-lucide="trash-2" style="width: 16px;"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center py-4 text-muted">
                            No companies yet.
                            <a href="{% url 'admin_portal:company_create' %}">Create the first company</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Info Card -->
    <div class="card mt-4 border-info">
        <div class="card-body">
            <h6 class="card-title text-info">
                <i data-lucide="info" class="me-2" style="width: 18px;"></i>
                Platform Admin Scope
            </h6>
            <p class="card-text text-muted mb-0">
                As a Platform Admin, you can create and manage companies and their initial administrators.
                You do not have access to internal company data such as individual users, stores, expenses, or tasks.
                Each Company Admin manages their own company's data independently.
            </p>
        </div>
    </div>
</div>
{% endblock %}