{% extends "base/base.html" %}

{% block title %}{{ course.title }}{% endblock %}

{% block navbar %}
{% include "base/navbar.html" %}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
    <div class="card mb-4 border-0 shadow-sm bg-primary text-white">
        <div class="card-body p-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-6 fw-bold mb-2">{{ course.title }}</h1>
                    <p class="lead mb-0">{{ course.description }}</p>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <div class="card bg-white text-dark d-inline-block text-start p-3 shadow-sm"
                        style="min-width: 200px;">
                        <small class="text-muted d-block mb-1">Your Progress</small>
                        <div class="d-flex align-items-center mb-2">
                            <h3 class="mb-0 me-2">{{ progress.progress_percent }}%</h3>
                            <span
                                class="badge {% if progress.status  ==  'completed' %}bg-success{% else %}bg-warning text-dark{% endif %}">
                                {{ progress.get_status_display }}
                            </span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-success"
                                style="width: {{ progress.progress_percent|default:'0' }}%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Syllabus -->
    <div class="row">
        <div class="col-lg-8">
            <h4 class="mb-3">Course Content</h4>

            <div class="accordion" id="courseAccordion">
                {% for module in modules %}
                <div class="accordion-item mb-3 border rounded shadow-sm overflow-hidden">
                    <h2 class="accordion-header" id="heading{{ module.id }}">
                        <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button"
                            data-bs-toggle="collapse" data-bs-target="#collapse{{ module.id }}">
                            <div class="d-flex flex-column">
                                <span class="fw-bold">{{ module.title }}</span>
                                <small class="text-muted">{{ module.description }}</small>
                            </div>
                        </button>
                    </h2>
                    <div id="collapse{{ module.id }}"
                        class="accordion-collapse collapse {% if forloop.first %}show{% endif %}"
                        data-bs-parent="#courseAccordion">
                        <div class="accordion-body p-0">
                            <div class="list-group list-group-flush">
                                <!-- Lessons -->
                                {% for lesson in module.lessons.all %}
                                <a href="{% url 'learning:lesson' lesson.pk %}"
                                    class="list-group-item list-group-item-action d-flex align-items-center py-3">
                                    <div class="me-3">
                                        {% if lesson.id in completed_lesson_ids %}
                                        <i data-lucide="check-circle" class="text-success"></i>
                                        {% else %}
                                        <i data-lucide="circle" class="text-muted"></i>
                                        {% endif %}
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="d-flex align-items-center">
                                            <span class="me-2">{{ lesson.title }}</span>
                                            <span class="badge bg-light text-secondary border">
                                                {% if lesson.content_type  ==  'video' %}
                                                <i data-lucide="play-circle" style="width:12px;height:12px;"
                                                    class="me-1"></i> Video
                                                {% elif lesson.content_type == 'text' %}
                                                <i data-lucide="file-text" style="width:12px;height:12px;"
                                                    class="me-1"></i> Article
                                                {% else %}
                                                <i data-lucide="file" style="width:12px;height:12px;" class="me-1"></i>
                                                PDF
                                                {% endif %}
                                                {{ lesson.duration_minutes }} min
                                            </span>
                                        </div>
                                    </div>
                                    <i data-lucide="chevron-right" class="text-muted"
                                        style="width:16px;height:16px;"></i>
                                </a>
                                {% endfor %}

                                <!-- Quizzes -->
                                {% for quiz in module.quizzes.all %}
                                <a href="{% url 'learning:quiz' quiz.pk %}"
                                    class="list-group-item list-group-item-action list-group-item-warning d-flex align-items-center py-3">
                                    <div class="me-3">
                                        <i data-lucide="help-circle" class="text-warning"></i>
                                    </div>
                                    <div class="flex-grow-1 fw-bold">
                                        Quiz: {{ quiz.title }}
                                    </div>
                                    <span class="badge bg-warning text-dark">Take Quiz</span>
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Sidebar Info -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="card-title">About this Course</h5>
                    <ul class="list-unstyled text-muted mb-0">
                        <li class="mb-2 d-flex align-items-center">
                            <i data-lucide="layers" class="me-2" style="width:18px;"></i>
                            {{ modules.count }} Modules
                        </li>
                        <li class="mb-2 d-flex align-items-center">
                            <i data-lucide="clock" class="me-2" style="width:18px;"></i>
                            Self-paced
                        </li>
                        <li class="d-flex align-items-center">
                            <i data-lucide="award" class="me-2" style="width:18px;"></i>
                            Certificate on completion
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}